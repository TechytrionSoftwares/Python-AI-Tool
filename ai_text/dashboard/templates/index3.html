{% extends 'base.html' %}
{% block title %}Practice | AI Effective Tool{% endblock %}

{% block content %}
<!-- your existing main content below -->
<div class="main-container">
  <h1>Convert Audio, Speech & Video to <span>Text</span></h1>
  <p class="sub-text">Fast. Accurate. AI-powered transcription & insights.</p>

<div class="tabs">
  <button class="tab-btn active" data-tab="audio">Audio to Text</button>
  <button class="tab-btn" data-tab="video">Video to Text</button>
</div>

<!-- ‚úÖ Everything below is unchanged -->
<!-- AUDIO TAB -->
<div class="card-box" id="audio" style="display:block;">
  <h2 class="section-title">üéß Upload Audio File</h2>
  <form method="POST" enctype="multipart/form-data" action="{% url 'practice' %}">
    {% csrf_token %}
    <label class="upload-area" id="audioLabel">
      <div class="icon">‚¨Ü</div>
      <span><strong>Click or Drag & Drop</strong> to upload audio</span>
      <small style="opacity:.6;">MP3, WAV, M4A, FLAC</small>
    </label>
    <input type="file" name="audio_file" id="audioInput" class="file-input" accept=".mp3,.wav,.m4a,.flac">
    <div class="selected-file-name" id="audioFileName">No file selected</div>
    <button type="submit" class="primary-btn" style="margin-top:18px;">Convert Audio</button>
  </form>

  <!-- {% if transcript %}
  <div class="output-card">
    <p>{{ transcript }}</p>
    {% if pdf_url %}
    <a href="{{ pdf_url }}" target="_blank" class="btn-success">Download PDF</a>
    {% endif %}
  </div>

  {% if filler_analysis.total_fillers %}
  <div class="result-card">
    <div class="section-title">üó£Ô∏è Filler Word Analysis</div>
    <p><strong>Total:</strong> {{ filler_analysis.total_fillers }}</p>
    <p><strong>Per Minute:</strong> {{ filler_analysis.fillers_per_minute }}</p>
    {% for word, count in filler_analysis.filler_frequency.items %}
      <span class="filler-tag">{{ word }} √ó {{ count }}</span>
    {% endfor %}
  </div>
  {% endif %}

  {% if pacing_analysis.wpm %}
  <div class="result-card">
    <div class="section-title">‚è±Ô∏è Speaking Pace</div>
    <p><strong>WPM:</strong> {{ pacing_analysis.wpm }}</p>
    <p>{{ pacing_analysis.pace_feedback }}</p>
  </div>
  {% endif %}

  {% if grammar_results %}
  <div class="result-card">
    <div class="section-title">üìù Grammar & Clarity Suggestions</div>
    <div class="prose leading-relaxed">
      {% if grammar_inline %}
        <p>{{ grammar_inline|safe }}</p>
      {% else %}
        <p class="text-gray-500">No grammar improvements detected.</p>
      {% endif %}
    </div>
    <p class="text-sm text-gray-500 mt-3">
      <span style="color:#d93025;">Red = Original mistake</span>,
      <span style="color:#1a8917;">Green = Correction</span>
    </p>
  </div>
  {% endif %}
  {% endif %} -->
</div>

<!-- VIDEO TAB -->
<div class="card-box" id="video">
  <h2 class="section-title">üé¨ Upload Video</h2>
  <form method="POST" enctype="multipart/form-data" action="{% url 'practice' %}">
    {% csrf_token %}
    <label class="upload-area" id="videoLabel">
      <div class="icon">‚¨Ü</div>
      <span><strong>Click or Drag & Drop</strong> to upload video</span>
      <small style="opacity:.6;">MP4, MOV, MKV</small>
    </label>
    <input type="file" name="video_file" id="videoInput" class="file-input" accept="video/*">
    <div class="selected-file-name" id="videoFileName">No file selected</div>
    <button type="submit" class="primary-btn" style="margin-top:18px;">Convert Video</button>
  </form>

  <!-- {% if video_transcript or transcript %}
  <div class="output-card">
    <p>{{ video_transcript|default:transcript }}</p>
    {% if pdf_url %}
      <a href="{{ pdf_url }}" target="_blank" class="btn-success">Download PDF</a>
    {% endif %}
  </div>
  {% endif %} -->
</div>
</div>


<!-- ‚úÖ Processing Overlay + Success Notification -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  // When user submits any form (audio or video)
  document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", function(e) {
      // Create overlay
      const overlay = document.createElement("div");
      overlay.id = "processing-overlay";
      Object.assign(overlay.style, {
        position: "fixed",
        top: "0",
        left: "0",
        width: "100%",
        height: "100%",
        background: "rgba(0, 0, 0, 0.7)",
        display: "flex",
        flexDirection: "column",
        justifyContent: "center",
        alignItems: "center",
        color: "#fff",
        fontSize: "18px",
        zIndex: "9999",
        textAlign: "center",
      });

      overlay.innerHTML = `
        <div>
          <div style="
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin: 0 auto;
            animation: spin 1s linear infinite;">
          </div>
          <p style="margin-top:15px;line-height:1.5;">
            File is being processed...
          </p>
        </div>
      `;

      // Add spinner animation
      const style = document.createElement("style");
      style.textContent = `
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(style);

      document.body.appendChild(overlay);
    });
  });
});
</script>
{% if transcript or video_transcript %}
<script>
  window.addEventListener("load", () => {
    // Remove overlay if still visible
    const overlay = document.getElementById("processing-overlay");
    if (overlay) overlay.remove();

    // Show success toast
    const toast = document.createElement("div");
    toast.textContent = "‚úÖ Processing complete! Your results are ready.";
    Object.assign(toast.style, {
      position: "fixed",
      bottom: "20px",
      right: "20px",
      background: "#4CAF50",
      color: "#fff",
      padding: "10px 15px",
      borderRadius: "8px",
      boxShadow: "0 2px 8px rgba(0,0,0,0.3)",
      fontSize: "14px",
      zIndex: "10000",
    });
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
  });
</script>
{% endif %}

{% endblock %}


